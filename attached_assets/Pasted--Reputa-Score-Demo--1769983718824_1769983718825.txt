الهدف:
تحويل تطبيق Reputa Score من وضع Demo/حسابات وهمية إلى نظام حقيقي يعمل فعليًا، عبر تفعيل البروتوكول الموجود حاليًا في التطبيق (Reputation Protocol) كما هو دون تغييره أو إعادة تصميمه، مع جعله يعمل بشكل تراكمي، موحّد، ومخزّن عبر الزمن لكل مستخدم.

المبدأ الأساسي:
- يوجد بروتوكول حساب سمعة واحد فقط (الموجود حاليًا في التطبيق).
- يمنع منعًا باتًا إنشاء منطق حساب جديد أو Demo بديل.
- كل الصفحات (Home / Profile / Activity / Analytics / Network) يجب أن تقرأ من نفس ناتج البروتوكول.

هوية المستخدم:
- الهوية الأساسية للمستخدم هي:
  pi_username + wallet_address
- يتم إنشاء سجل دائم لكل مستخدم تحت المفتاح:
  user:{pi_username}

Storage (إجباري):
- إنشاء StorageAdapter موحّد بواجهات:
  get(key)
  set(key, value)
  update(key, updater)
- التنفيذ:
  - Vercel KV = المصدر الحقيقي للحسابات
  - localStorage = يستخدم فقط في وضع Demo
- أي نقاط أو تسجيل دخول أو سمعة لا تُخزن في KV تعتبر غير صالحة.

بنية بيانات المستخدم (موحّدة):
{
  wallet: string,
  network: "mainnet" | "testnet",
  reputationScore: number,
  level: number,
  trustRank: string,

  walletMetrics: {
    balance: number,
    txCount: number,
    walletAgeDays: number,
    activityScore: number
  },

  dailyLogin: {
    totalPoints: number,
    lastLogin: timestamp,
    streak: number
  },

  history: {
    events: [],
    lastCalculated: timestamp
  }
}

تفعيل الحساب الحقيقي:
- عند ربط المحفظة أو فحصها أول مرة:
  - جلب البيانات الفعلية المتاحة (الرصيد، عدد التحويلات، عمر المحفظة، النشاط).
  - تمرير هذه البيانات إلى البروتوكول الحالي دون تعديل معادلاته.
  - تخزين نتيجة الحساب الأولي في Vercel KV.
- يمنع إعادة الحساب من الصفر عند كل دخول.

نظام النقاط التراكمي:
- أي تفاعل جديد (فحص محفظة، نشاط، تسجيل دخول) يُسجَّل كـ Event.
- البروتوكول الحالي يضيف النقاط تراكميًا:
  previousScore + earnedPoints = newScore
- لا Reset
- لا حسابات مؤقتة في الواجهة.

نظام التسجيل اليومي:
- يبدأ من 0 للمستخدم الجديد.
- يحتسب تراكميًا (+3 يوميًا).
- يُخزن دائمًا في KV.
- لا يختفي عند إعادة التحميل.
- لا يؤثر على السمعة إلا عبر تمريره للبروتوكول.

وضع الشبكات:
- Mainnet = الأساس في الحساب.
- Testnet = مكمل ثانوي.
- Demo = معزول تمامًا ولا يكتب في KV.
- التحويل بين الشبكات واضح للمستخدم.

Backend:
- استخدام Vercel KV + API Routes فقط.
- لا قواعد بيانات خارجية.
- لا حسابات داخل الواجهة (Frontend).

ممنوعات:
- ❌ إنشاء بروتوكول جديد
- ❌ اختلاف السكور بين الصفحات
- ❌ تصفير النقاط عند reload
- ❌ اعتماد الحساب على state فقط

النتيجة المطلوبة:
- كل مستخدم يملك تاريخًا محفوظًا.
- نظام سمعة حقيقي يعمل مع الزمن.
- التطبيق يصبح جاهزًا للتوسع وعمليات airdrop مستقبلية.
